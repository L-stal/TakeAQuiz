@page "/profile"
@using TakeAQuiz.Shared.ViewModels;
@inject HttpClient Http
@inject AuthenticationStateProvider AuthenticationStateProvider

<MudGrid Class="pa-10">
    <MudItem xs="12">
        <MudPaper Elevation="4" Class="pa-6 ma-4">
            @if (userInfo != null)
            {
                <MudText Typo="Typo.h4">@userInfo.UserName</MudText>
            }
            else
            {
                <p>User information is not available.</p>
            }
        </MudPaper>
    </MudItem>

    <MudItem xs="12">
        <MudPaper Elevation="4" Class="pa-6 ma-4">
            <MudText Typo="Typo.h4">Your created Quizzes</MudText>
            <MudTabs Outlined="true" Position="Position.Top" Rounded="true" Border="true"
                     ApplyEffectsToContainer="true" Class="mt-8" PanelClass="pa-6">
                @if (userInfo != null)
                {
                    @for (int i = 0; i < userInfo.Quizzes.Count(); i++)
                    {
                        <MudTabPanel Text="@userInfo.Quizzes[i].Title.ToString()">
                            <MudText>Content One</MudText>
                        </MudTabPanel>
                    }
                }
                else
                {
                    
                }
            </MudTabs>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    private UserViewModel userInfo;

    protected override async Task OnInitializedAsync()
    {
        var user = (await AuthenticationStateProvider.GetAuthenticationStateAsync()).User.Identity;

        if (user != null && user.IsAuthenticated)
        {
            userInfo = await Http.GetFromJsonAsync<UserViewModel>("api/profile/getuserdata");
        }
    }
}
